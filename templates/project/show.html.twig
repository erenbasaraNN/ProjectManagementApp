{% extends 'base.html.twig' %}

{% block title %}Project: {{ project.name }}{% endblock %}

{% block body %}
    <div class="project-header">
        <h1>{{ project.name }}</h1>
        <p>{{ project.description }}</p>
    </div>
    <div class="project-page container">
        <!-- Grouped Issues Table -->
        <div class="issue-groups">
            {% for tag in tags %}
                <div class="group">
                    <!-- Tag Group Header with color -->
                    <div class="group-header" style="border-left: 20px solid {{ tag.color }}; border-radius:5px;">
                        <h3>{{ tag.name }}</h3>
                    </div>
                    <table class="issue-table">
                        <thead>
                        <tr>
                            <th>Görev</th>
                            <th>Kişi</th>
                            <th>Durum</th>
                            <th>Tarih</th>
                            <th>Priority</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if tag.issues|length > 0 %}
                            {% for issue in tag.issues %}
                                <tr>
                                    <td>
                                        <span class="issue-name" data-id="{{ issue.id }}" contenteditable="true">{{ issue.name }}</span>
                                        <button class="open-updates-modal-btn" data-id="{{ issue.id }}">
                                            <i class="fa-regular fa-comment"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <div class="user-list">
                                            <!-- Tagify Input for Assignee Editing -->
                                            <input class="tagify-input" name="assignees" data-id="{{ issue.id }}"
                                                   value="{% for user in issue.assignees %}{{ user.name }}{% if not loop.last %}, {% endif %}{% endfor %}"
                                                   placeholder="Kişi seç...">
                                        </div>
                                    </td>

                                    <td>
                                        <div class="status-tagify-container">
                                            <!-- Tagify Input for Status -->
                                            <input class="status-tagify" name="status" data-id="{{ issue.id }}"
                                                   value="{{ issue.status }}" placeholder="Durum seç...">
                                        </div>
                                    </td>


                                    <td>
                                        <input type="text" class="datepicker" data-id="{{ issue.id }}" value="{{ issue.endDate ? issue.endDate|date('d M Y') : 'No Deadline' }}">
                                    </td>

                                    <td>
                                        <div class="priority-tagify-container">
                                            <input class="priority-tagify" name="priority" data-id="{{ issue.id }}" value="{{ issue.priority }}" placeholder="Öncelik seç...">
                                        </div>
                                    </td>



                                </tr>
                            {% endfor %}
                            <tr class="add-issue-row">
                                <td colspan="6">
                                    <a href="#" class="add-issue-link" data-tag-id="{{ tag.id }}">
                                        <i class="fas fa-plus"></i> öğe ekle
                                    </a>
                                </td>
                            </tr>

                        {% else %}
                            <tr>
                                <td colspan="6">No issues available under this group. <a href="#" class="add-issue-link" data-tag-id="{{ tag.id }}">
                                        <i class="fas fa-plus"></i> öğe ekle
                                    </a></td>

                            </tr>

                        {% endif %}
                        </tbody>
                    </table>
                </div>
            {% endfor %}
        </div>

        <!-- Add New Group Button -->
        <button class="btn new-group-btn" id="add-group-btn">+ Yeni grup ekle</button>

        <!-- Modal for adding a new group -->
        <div class="modal" id="add-group-modal" style="display: none;">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>Yeni Grup Ekle</h2>
                <form id="add-group-form">
                    <div class="form-group">
                        <label for="groupName">Group Name</label>
                        <input type="text" id="groupName" name="group_name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="groupColor">Group Color</label>
                        <input type="color" id="groupColor" name="group_color" value="#000000" class="form-control" required>
                    </div>

                    <!-- Add CSRF Token -->
                    <input type="hidden" name="_token" value="{{ csrf_token('add_group') }}">

                    <button type="submit" class="btn btn-primary">Add Group</button>
                </form>
            </div>
        </div>

    </div>

    <meta name="project-id" content="{{ project.id }}">

{% endblock %}
